# Conversor Word a SCORM - ARELANCE
# Configuración de seguridad Apache

# Proteger archivos sensibles
<FilesMatch "\.(php|log|md)$">
    <IfModule mod_authz_core.c>
        Require all denied
    </IfModule>
    <IfModule !mod_authz_core.c>
        Order deny,allow
        Deny from all
    </IfModule>
</FilesMatch>

# Permitir index.php
<Files "index.php">
    <IfModule mod_authz_core.c>
        Require all granted
    </IfModule>
    <IfModule !mod_authz_core.c>
        Order allow,deny
        Allow from all
    </IfModule>
</Files>

# Permitir API endpoints
<Files "auth.php">
    <IfModule mod_authz_core.c>
        Require all granted
    </IfModule>
    <IfModule !mod_authz_core.c>
        Order allow,deny
        Allow from all
    </IfModule>
</Files>

<Files "analyze.php">
    <IfModule mod_authz_core.c>
        Require all granted
    </IfModule>
    <IfModule !mod_authz_core.c>
        Order allow,deny
        Allow from all
    </IfModule>
</Files>

<Files "generate.php">
    <IfModule mod_authz_core.c>
        Require all granted
    </IfModule>
    <IfModule !mod_authz_core.c>
        Order allow,deny
        Allow from all
    </IfModule>
</Files>

<Files "test_generate.php">
    <IfModule mod_authz_core.c>
        Require all granted
    </IfModule>
    <IfModule !mod_authz_core.c>
        Order allow,deny
        Allow from all
    </IfModule>
</Files>

<Files "debug_content.php">
    <IfModule mod_authz_core.c>
        Require all granted
    </IfModule>
    <IfModule !mod_authz_core.c>
        Order allow,deny
        Allow from all
    </IfModule>
</Files>

<Files "download.php">
    <IfModule mod_authz_core.c>
        Require all granted
    </IfModule>
    <IfModule !mod_authz_core.c>
        Order allow,deny
        Allow from all
    </IfModule>
</Files>

<Files "templates.php">
    <IfModule mod_authz_core.c>
        Require all granted
    </IfModule>
    <IfModule !mod_authz_core.c>
        Order allow,deny
        Allow from all
    </IfModule>
</Files>

# Proteger carpetas sensibles
<IfModule mod_rewrite.c>
    RewriteEngine On
    
    # Bloquear acceso directo a includes
    RewriteRule ^includes/ - [F,L]
    
    # Bloquear acceso directo a logs
    RewriteRule ^logs/ - [F,L]
    
    # Bloquear acceso directo a data
    RewriteRule ^data/ - [F,L]
    
    # Permitir API
    RewriteCond %{REQUEST_URI} ^/api/
    RewriteRule ^api/(.*)\.php$ api/$1.php [L]
</IfModule>

# Proteger archivos de configuración
<Files "config.php">
    <IfModule mod_authz_core.c>
        Require all denied
    </IfModule>
</Files>

# Deshabilitar listado de directorios
Options -Indexes

# Configuración de charset
AddDefaultCharset UTF-8

# Configuración de caché para assets
<IfModule mod_expires.c>
    ExpiresActive On
    ExpiresByType text/css "access plus 1 week"
    ExpiresByType application/javascript "access plus 1 week"
    ExpiresByType image/png "access plus 1 month"
    ExpiresByType image/jpeg "access plus 1 month"
</IfModule>

# Compresión GZIP
<IfModule mod_deflate.c>
    AddOutputFilterByType DEFLATE text/html text/css application/javascript application/json
</IfModule>
